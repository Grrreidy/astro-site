---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
---

<html lang="en">
  <head>
    <BaseHead title="RAG Componenta11y" description="Generate accessibility guidance powered by RAG data" />
  </head>
  <body>
    <Header />
    <main id="main-content" class="container blog">
      <h1 class="h1-small">RAG-powered accessibility guidance</h1>

      <form id="a11y-form" class="a11y-form" novalidate>
        <div class="form-field">
          <label for="component">Component</label>
          <input id="component" name="component" required aria-describedby="component-help" />
          <p id="component-help" class="field-help">
            Try: accordion, button, modal, tooltip...
          </p>
        </div>
        <button id="generate-btn" type="submit" class="default-button">
          <span>Generate guidance</span>
          <span id="btn-spinner" class="btn-spinner" aria-hidden="true"></span>
        </button>
      </form>

      <section id="result" class="a11y-result blog-content" hidden>
        <div id="output"></div>
      </section>
    </main>
    <Footer />

    <script type="module" is:inline>
      const form = document.getElementById('a11y-form');
      const spinner = document.getElementById('btn-spinner');
      const result = document.getElementById('result');
      const out = document.getElementById('output');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        spinner.classList.add('active');
        result.hidden = true;
        out.innerHTML = '';

        const component = form.component.value.trim().toLowerCase();
        const res = await fetch('/.netlify/functions/RAG-componenta11y', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ component })
        });
        const data = await res.json();
        spinner.classList.remove('active');

        if (data.html) {
          out.innerHTML = data.html;
          result.hidden = false;
        } else {
          out.textContent = 'No guidance returned.';
          result.hidden = false;
        }
      });
    </script>
  </body>
</html>
